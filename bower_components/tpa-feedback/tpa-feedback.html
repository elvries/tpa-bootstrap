<link rel="import" href="../paper-button/paper-button.html">

<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">

<link rel="import" href="../neon-animation/neon-animated-pages.html">
<link rel="import" href="../neon-animation/animations/slide-left-animation.html">
<link rel="import" href="../neon-animation/animations/slide-from-right-animation.html">

<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../tpa-kitt/kitt-mocks/kitt-mocks.html">
<link rel="import" href="../tpa-kitt/kitt-platform/kitt-platform.html">

<!--
Feedback feature enables the customers to send feedback.
Example:
    <tpa-feedback></tpa-feedback>
@demo demo/index.html
-->

<dom-module id="tpa-feedback">

    <style>

        header {
            height: 134px;
            background-color: #efdbb9;
            margin: auto;
            position: relative;
        }

        header img {
            height: 144px;
            position: absolute;
            margin: 0 auto;
            top: 10px;
            left: 0;
            right: 0;
        }

        tpa-mobile-tablet-container {
            display: block;
            max-width: 650px;
            margin: 0 auto;
        }

        tpa-mobile-tablet-container paper-button {
            width: 100%;
        }

        textarea {
            width: 100%;
        }

        section#success img {
            margin-top: 20px;
            width: 144px;
            margin: 0 auto;
        }

        section .content {
            padding: 10px;
        }

    </style>
    <template>

        <iron-ajax id="ajax-send-feedback"
                   method="POST"
                   url="/api/feedback-next"
                   handle-as="json"
                   on-response="handleResponse"
                   debounce-duration="300"></iron-ajax>

        <kitt-mocks app-version="y.y.c"></kitt-mocks>

        <kitt-platform></kitt-platform>

        <neon-animated-pages selected="0" entry-animation="slide-from-right-animation"
                             exit-animation="slide-left-animation">

            <section id="intro">

                <header>
                    <img src="img/intro.png" alt="intro"/>
                </header>

                <tpa-mobile-tablet-container class="content">

                    <p>Heeft u een briljant idee of suggestie voor verbetering van de Mobiel Bankieren App? Dan horen we
                        dat graag! Met uw feedback maken we onze app nog beter.</p>

                    <paper-button class="primary" on-tap="next">Geef uw feedback</paper-button>

                    <h2>Technisch probleem?</h2>

                    <p>Voor een technisch probleem kunt u het beste direct contact opnemen met ING Klantenservice. We
                        helpen u graag.</p>

                    <paper-button class="primary" on-tap="call">Bel ING Klantenservice</paper-button>

                </tpa-mobile-tablet-container>

            </section>

            <section id="feedback">
                <textarea rows="5"></textarea>
                <tpa-mobile-tablet-container class="content">

                    <paper-button class="primary" on-tap="send">Verstuur</paper-button>

                    <p>We vragen uw persoonlijke feedback. Wij gebruiken uw feedback om onze diensten te verbeteren.</p>

                </tpa-mobile-tablet-container>
            </section>

            <section id="success">
                <tpa-mobile-tablet-container class="content">
                    <img src="img/success.png" alt="intro"/>
                    <paper-button class="primary" on-tap="close">Accounts</paper-button>
                </tpa-mobile-tablet-container>
            </section>

        </neon-animated-pages>

    </template>


    <script>
        Polymer({
            is: 'tpa-feedback',

            behaviors: [
                Polymer.NeonAnimatableBehavior
            ],

            call: function () {
                var kittPlatform = document.querySelector('kitt-platform');

                kittPlatform.getInfo().then(function (info) {
                    console.log("Info", info);
                })
            },

            next: function () {
                var pages = document.querySelector('neon-animated-pages');
                pages.selectNext();
            },

            back: function () {
                var pages = document.querySelector('neon-animated-pages');
                pages.selectPrevious();
            },

            send: function () {
                var pages = document.querySelector('neon-animated-pages');
                var ajax = document.querySelector('#ajax-send-feedback');

                var kittPlatform = document.querySelector('kitt-platform');
                var textArea = document.querySelector('textarea');

                kittPlatform.getInfo().then(function(info){
                    var text = textArea.value + "\n\nDevice: " + info.deviceManufacturer + "\n" + info.deviceName + " versie: " + info.deviceVersion + "\nApp versie: " + info.appVersion
                    ajax.body = JSON.stringify({
                        "labels": ["Mobiel", "MockOs"],
                        "text": text,
                        "type": "SUGGESTION"
                    });
                    ajax.generateRequest()
                    pages.selectNext();
                })

            },

            close: function () {
                console.log('Close')
                var pages = document.querySelector('neon-animated-pages');
                pages.selected = 0;
            },

            handleResponse: function (data) {
                console.log(data.detail.response);
            }

        });

    </script>

</dom-module>
