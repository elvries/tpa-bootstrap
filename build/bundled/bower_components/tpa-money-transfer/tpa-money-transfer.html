<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../iron-icons/iron-icons.html"><link rel="import" href="../iron-list/iron-list.html"><link rel="import" href="../iron-ajax/iron-ajax.html"><link rel="import" href="../iron-form/iron-form.html"><link rel="import" href="../tpa-font/tpa-font.html"><link rel="import" href="../tpa-icons/tpa-icons.html"><link rel="import" href="../tpa-styles/tpa-styles.html"><link rel="import" href="../tpa-date-picker/tpa-date-picker.html"><link rel="import" href="../paper-button/paper-button.html"><link rel="import" href="../paper-icon-button/paper-icon-button.html"><link rel="import" href="../paper-input/paper-input.html"><link rel="import" href="../paper-dialog/paper-dialog.html"><link rel="import" href="../paper-dialog-scrollable/paper-dialog-scrollable.html"><link rel="import" href="../paper-toast/paper-toast.html"><link rel="import" href="../neon-animation/neon-animation.html"><link rel="import" href="../vaadin-combo-box/vaadin-combo-box.html"><link rel="import" href="../iron-signals/iron-signals.html"><link rel="import" href="../paper-dialog-behavior/paper-dialog-shared-styles.html"></head><body><dom-module id="tpa-money-transfer"><style>div.head{width:60%;float:left;}div [secondary]{color:var(--ing-orange-300);}div.amount{text-align:right;font-weight:bold;font-size:1.1rem;}paper-dialog.addressList{width:80%;display:block;}paper-dialog.addressList paper-dialog-scrollable{min-height:100px;}.addressContainer:after{content:".";clear:both;display:block;visibility:hidden;height:0px;}.addressContent{display:inline-block;float:left;margin-right:10px;padding:5px;cursor:pointer;}.addressContent:hover{background-color:var(--ing-orange-300);}.addressContainer{margin-right:-15px;margin-bottom:20px;}paper-icon-button{margin-left:10px;margin-right:10px;}.recipient{display:flex;align-items:center;}.recipient vaadin-combo-box{flex:1;}@media screen and (max-width: 360px){.recipient paper-icon-button{display:none;}}</style><template><iron-signals on-iron-signal-i18n="_onI18Signal"></iron-signals><form is="iron-form" id="form" method="post" action="/api/transferMoney" content-type="application/json"><div class="card-content"><div class="head"><div>{{accountOwner}}</div><div secondary="">{{accountNumber}}</div></div><div class="amount">{{_accountBalanceObj.wholeNumber}}{{decimalSeparator}}<sup>{{_accountBalanceObj.decimals}}</sup></div><paper-input class="large" label="{{localize('amount')}}" type="number" name="amount" required=""><div prefix="">{{localize('currencySymbol')}}</div></paper-input><div class="recipient"><vaadin-combo-box label="{{localize('recipient')}}" items="{{addresses}}" item-label-path="fullname" item-value-path="fullname" name="recipient" required="" allow-custom-value=""></vaadin-combo-box><paper-icon-button icon="tpa:addressbook-empty" title="Addressbook" on-tap="toggleAddressBook"></paper-icon-button></div><paper-input label="{{localize('accountNumber')}}" name="accountNumber" placeholder$="{{localize('accountNumberExample')}}" required=""></paper-input><paper-input label="{{localize('usage')}}" name="usage" required=""></paper-input><tpa-date-picker label="{{localize('executionDate')}}" locale="{{language}}" min="{{now}}" max$="{{maxDate}}" format$="{{localize('dateFormat')}}" name="executionDate" required=""></tpa-date-picker></div><div class="card-actions"><paper-button raised="" class="primary" on-tap="submit">{{localize('submit')}}</paper-button></div></form><iron-ajax id="ajax" loading="{{loadingAddresses}}" url="/api/getAddressBook" handle-as="json" on-response="_onAddressBookData" auto=""></iron-ajax><paper-dialog id="dialog" class="addressList" title="Adress Book" entry-animation="fade-in-animation" exit-animation="fade-out-animation"><paper-dialog-scrollable><div class="addressContainer"><template is="dom-repeat" items="{{addresses}}" as="address"><div class="addressContent" on-tap="_chooseAddress">{{address.firstname}}&nbsp;{{address.lastname}}<br>{{address.account}}<br>{{address.institute}}</div></template></div></paper-dialog-scrollable><div class="buttons"><paper-button class="primary" dialog-dismiss="" autofocus="">{{localize('cancel')}}</paper-button></div></paper-dialog><paper-toast id="toast-error" text="{{localize('error')}}" duration="10000"><content select=".error"></content></paper-toast><paper-toast id="toast-success" text="{{localize('success')}}" duration="5000"><content select=".success"></content></paper-toast></template></dom-module><script>!function(){"use strict";var e=function(e,n,t,r,a){var o="\\d(?=(\\d{"+(t||3)+"})+"+(n>0?"\\D":"$")+")",c=e.toFixed(Math.max(0,~~n));return(a?c.replace(".",a):c).replace(new RegExp(o,"g"),"$&"+(r||","))};Polymer({is:"tpa-money-transfer",behaviors:[],properties:{accountOwner:{type:String},accountNumber:{type:String},accountBalance:{type:Number},_accountBalanceObj:{type:Object,computed:"__computeAccountBalanceObj(accountBalance, decimalSeparator, thousendsSeparator)"},decimalSeparator:{type:String,value:","},thousendsSeparator:{type:String,value:"."},loadingAddresses:Boolean,addresses:Array,now:{type:Date,value:function(){return new Date}},maxDate:new Date(2100,11,31),language:{type:String,value:"en-au"},resources:{type:Object,value:function(){return{"en-au":{recipient:"Recipient",accountNumber:"Account number",usage:"Description",executionDate:"Execution date",submit:"Submit",amount:"Amount",dateFormat:"l",error:"Error",cancel:"Cancel",accountNumberExample:"e.g. 4782894723 234",currencySymbol:"$"},"de-de":{recipient:"Empfänger",accountNumber:"Kontonummer",usage:"Verwendungszweck",executionDate:"Ausführungsdatum",submit:"Ausführen",amount:"Betrag",dateFormat:"l",error:"Fehler",cancel:"Abbrechen",accountNumberExample:"z.B. DE15500105171234567890",currencySymbol:"€"},"nl-nl":{recipient:"Ontvanger",accountNumber:"Rekeningnummer",usage:"Mededeling of Betalingskenmerk",executionDate:"Dag van executie",submit:"Uitvoeren",amount:"Bedrag",dateFormat:"l",error:"Fout",cancel:"Annuleer",accountNumberExample:"bijv. NL15500105171234567890",currencySymbol:"€"}}}},localize:{type:Function,computed:"__computeLocalize(language, resources)"}},__computeAccountBalanceObj:function(n,t,r){var a,o={wholeNumber:0,decimals:0};return n&&(a=e(n,2,3,r,t).split(t),o.wholeNumber=a[0],o.decimals=a[1]),o},toggleAddressBook:function(){this.$.dialog.toggle()},_onAddressBookData:function(e){this.addresses=e.detail.response.map(function(e){return e.fullname=e.firstname+" "+e.lastname,e})},ready:function(){var e=this,n=e.$.form;n.addEventListener("iron-form-error",function(){e._onError()}),n.addEventListener("iron-form-response",function(n){e._onSuccess(n)}),n.recipient&&(n.recipient.className+=" srch")},_onError:function(){this.$["toast-error"].open()},_onSuccess:function(e){var n=this,t=n.$;if(e&&e.detail&&e.detail.response){var r=e.detail.response;if(r.success!==!0)return n._onError();r.balance&&(this.accountBalance=r.balance)}t["toast-success"].open(),t.form.reset(),this.fire("tpa-money-transfer-success")},_chooseAddress:function(e){var n,t=this,r=t.$.form;n=e.model.__data__.address,r.recipient.value=n.firstname+" "+n.lastname,r.accountNumber.value=n.account,r.accountNumber.fire("blur"),r.recipient.fire("blur"),t.toggleAddressBook()},submit:function(e){this.$.form.submit()},_onI18Signal:function(e,n,t){this.resources[n]&&(this.language=n)},__computeLocalize:function(e,n){Array.prototype.slice.call(arguments);return function(t){return n[e]&&n[e][t]||""}}})}();</script></body></html>