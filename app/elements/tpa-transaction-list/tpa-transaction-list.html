<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="tpa-transactions-list-styles.html">
<link rel="import" href="tpa-transaction-list-i18n.html">
<dom-module name="tpa-transaction-list">
    <template>
        <style include="tpa-transactions-list-styles">
        </style>
        <tpa-transaction-list-i18n
                id="i18ncontent"
                content="{{i18ncontent}}"
                currency-symbol-code="{{currencySymbolCode}}"></tpa-transaction-list-i18n>
        <!--<iron-ajax-->
                <!--auto-->
                <!--id="getTransactions"-->
                <!--url="/gettransactions"-->
                <!--handle-as="json"-->
                <!--on-response="getResponse">-->
        <!--</iron-ajax>-->
        <h3>{{title}}</h3>
        <div>
            <template as="transactionGroup" is="dom-repeat" items="{{transactions}}">
                <div class="date-header" style="padding-left:10px; padding-bottom:10px">{{getGroupTitle(transactionGroup)}} <span style="float:right"><span>{{i18ncontent.currencyName}}</span> ({{currencySymbolCode}})</span></div>
                <template is="dom-repeat" as="item" items="{{transactionGroup.transactions}}">
                    <div class$="{{computeRowClass(hideIcon)}}">
                        <div class="main-text">
                            <paper-icon-button hidden$="{{hideIcon}}" disabled icon="{{item.icon}}"></paper-icon-button>{{item.name}}
                            <span style="float:right">{{currencySymbolCode}}<span>{{item.amount}}</span></span>
                        </div>
                        <div hidden$="{{hideSubText}}" class="sub-text">{{item.subText}}</div>
                    </div>
                </template>
            </template>
        </div>
    </template>
    <script>
        Polymer({
            is: "tpa-transaction-list",
            properties: {
                i18ncontent:{
                    type:Object,
                    notify:true
                },
                currencySymbolCode:{
                    type:String,
                    notify:true
                },
                hideIcon: {
                    type: Boolean,
                    value: false
                },
                hideSubText: {
                    type: Boolean,
                    value: false
                },
                groupTitleField:{
                    type: String,
                    value: "date"
                },
                transactions: {
                    type: Array,
                    value: [],
                    notify:true
                },
                title: {
                    type: "String",
                    value: "",
                    notify:true
                }
            },
            ready:function(){
              this.transactions = getTransactions(this.groupTitleField);
//                this.$.getTransactions.generateRequest();
            },
            getGroupTitle: function(group){
                return group[this.groupTitleField];
            },
            computeRowClass : function(hideIcon){
                var className = "row";

                if (hideIcon){
                    className += " no-icon";
                }

                return className;
            },
            getResponse: function(data){
                this.transactions = data.detail.response.transactionGroups;
            },
            getCurrencySymbol: function(currencyCode){
                return String.fromCharCode(currencyCode);
            }
        });

        // temp func to get mock data should be replaced with a blueprint
        function getTransactions(type){
          console.log(this.groupTitleField);
          if(type == "date"){
            return [
              {
                "date": "11 Feb",
                "accountType": "Saving accounts",
                "transactions": [
                  {
                    "name":"Sporting Equipment",
                    "amount":"10.00",
                    "icon":"rowing",
                    "subText":"NL20 INGDB 000131231"
                  },
                  {
                    "name":"transaciton3",
                    "amount":"1.56",
                    "icon":"add-shopping-cart",
                    "subText":"NL20 INGDB 00388881"
                  }
                ]
              },
              {
                "date": "12 Feb",
                "accountType": "Checking accounts",
                "transactions": [
                  {
                    "name":"transaciton1",
                    "amount":"29.30",
                    "icon":"rowing",
                    "subText":"NL20 INGDB 0007878798"
                  }
                ]
              },
              {
                "date": "15 Feb",
                "accountType": "Savings",
                "transactions": [
                  {
                    "name":"transaciton1",
                    "amount":"109.06",
                    "icon":"home",
                    "subText":"NL20 INGDB 0001123"
                  },
                  {
                    "name":"transaciton2",
                    "amount":"88.00",
                    "icon":"card-giftcard",
                    "subText":"NL20 INGDB 00041244"
                  },
                  {
                    "name":"transaciton3",
                    "amount":"10.00",
                    "icon":"perm-phone-msg",
                    "subText":"NL20 INGDB 0023232231"
                  }
                ]
              }
            ]}
          else {
            return [
              {
                "accountType": "Saving accounts",
                "transactions": [
                  {
                    "name":"My Savings account",
                    "amount":"10.00",
                    "icon":"rowing",
                    "subText":"NL20 INGDB 000131231"
                  },
                  {
                    "name":"My other savings account",
                    "amount":"1.56",
                    "icon":"add-shopping-cart",
                    "subText":"NL20 INGDB 00388881"
                  }
                ]
              },
              {
                "accountType": "Checking accounts",
                "transactions": [
                  {
                    "name":"Check account",
                    "amount":"29.30",
                    "icon":"rowing",
                    "subText":"NL20 INGDB 0007878798"
                  }
                ]
              },
              {
                "accountType": "Credit",
                "transactions": [
                  {
                    "name":"My Wifes Credit card",
                    "amount":"109.06",
                    "icon":"home",
                    "subText":"NL20 INGDB 0001123"
                  },
                  {
                    "name":"My Credit Card",
                    "amount":"88.00",
                    "icon":"card-giftcard",
                    "subText":"NL20 INGDB 00041244"
                  }
                ]
              }
            ]
          }
        }
    </script>
</dom-module>
