<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../ing-style/ing-fonts.html" type="css">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="tpa-transactions-list-styles.html">
<link rel="import" href="tpa-transaction-list-i18n.html">
<dom-module name="tpa-transaction-list">
    <template>
        <style include="tpa-transactions-list-styles">
        </style>
        <tpa-transaction-list-i18n
                id="i18ncontent"
                content="{{i18ncontent}}"
                currency-symbol-code="{{currencySymbolCode}}"></tpa-transaction-list-i18n>
        <iron-ajax
                auto
                id="getTransactions"
                url="/gettransactions"
                handle-as="json"
                on-response="getResponse">
        </iron-ajax>
        <h3>{{title}}</h3>
        <div>
            <template as="transactionGroup" is="dom-repeat" items="{{transactions}}">
                <div class="date-header" style="padding-left:10px; padding-bottom:10px">{{getGroupTitle(transactionGroup)}} <span style="float:right"><span>{{i18ncontent.currencyName}}</span> ({{currencySymbolCode}})</span></div>
                <template is="dom-repeat" as="item" items="{{transactionGroup.transactions}}">
                    <div class$="{{computeRowClass(hideIcon)}}">
                        <div class="main-text">
                            <paper-icon-button hidden$="{{hideIcon}}" disabled icon="{{item.icon}}"></paper-icon-button>{{item.name}}
                            <span style="float:right">{{currencySymbolCode}}<span>{{item.amount}}</span></span>
                        </div>
                        <div hidden$="{{hideSubText}}" class="sub-text">{{item.subText}}</div>
                    </div>
                </template>
            </template>
        </div>
    </template>
    <script>
        Polymer({
            is: "tpa-transaction-list",
            properties: {
                i18ncontent:{
                    type:Object,
                    notify:true
                },
                currencySymbolCode:{
                    type:String,
                    notify:true
                },
                hideIcon: {
                    type: Boolean,
                    value: false
                },
                hideSubText: {
                    type: Boolean,
                    value: false
                },
                groupTitleField:{
                    type: String,
                    value: "date"
                },
                transactions: {
                    type: Array,
                    value: [],
                    notify:true
                },
                title: {
                    type: "String",
                    value: "",
                    notify:true
                }
            },
            ready:function(){
                this.$.getTransactions.generateRequest();
            },
            getGroupTitle: function(group){
                return group[this.groupTitleField];
            },
            computeRowClass : function(hideIcon){
                var className = "row";

                if (hideIcon){
                    className += " no-icon";
                }

                return className;
            },
            getResponse: function(data){
                this.transactions = data.detail.response.transactionGroups;
            },
            getCurrencySymbol: function(currencyCode){
                return String.fromCharCode(currencyCode);
            }
        });
    </script>
</dom-module>
